<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Leaderboard Realtime</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(120deg, #141E30, #243B55);
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 2.2em;
      margin-bottom: 20px;
      letter-spacing: 1px;
    }
    table {
      margin: auto;
      border-collapse: collapse;
      width: 80%;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      padding: 12px 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.15);
      transition: all 0.3s ease;
    }
    th {
      background: rgba(0, 0, 0, 0.3);
      text-transform: uppercase;
    }
    tr {
      transition: transform 0.5s ease, background 0.5s ease;
    }
    tr.up {
      background: rgba(0,255,0,0.1);
      transform: translateY(-5px);
    }
    tr.down {
      background: rgba(255,0,0,0.1);
      transform: translateY(5px);
    }
    .rank-1 td { background: rgba(255, 215, 0, 0.25); font-weight: bold; }   /* Gold */
    .rank-2 td { background: rgba(192,192,192,0.25); }  /* Silver */
    .rank-3 td { background: rgba(205,127,50,0.25); }   /* Bronze */
    .updated {
      margin-top: 10px;
      font-size: 0.9em;
      color: #ccc;
    }
  </style>
</head>
<body>
  <h1>üèÜ Leaderboard Tim</h1>
  <table id="leaderboard">
    <thead>
      <tr><th>Rank</th><th>Nama</th><th>Tim</th><th>Level</th><th>Skor</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="updated" id="lastUpdate">Memuat data...</div>

  <script>
    // üîó Ganti URL di bawah ini dengan URL OpenSheet kamu
    const sheetURL = 'https://opensheet.elk.sh/16XAKQqfpqijOiVeU8WV6g-Oq2DBOBeM2NCENaklRgLc/November 2025';

    let previousRanks = {};

    async function updateLeaderboard() {
      try {
        const res = await fetch(sheetURL);
        const data = await res.json();

        // Urutkan data berdasarkan skor tertinggi
        data.sort((a, b) => Number(b.Skor) - Number(a.Skor));

        const tbody = document.querySelector("#leaderboard tbody");
        let html = '';

        data.forEach((row, i) => {
          const rank = i + 1;
          const prevRank = previousRanks[row.Nama];
          let rowClass = '';

          // Deteksi pergerakan posisi
          if (prevRank && prevRank > rank) rowClass = 'up';
          else if (prevRank && prevRank < rank) rowClass = 'down';

          // Simpan posisi sekarang
          previousRanks[row.Nama] = rank;

          // Tambahkan warna khusus top 3
          const rankClass = rank <= 3 ? `rank-${rank}` : '';

          html += `
            <tr class="${rankClass} ${rowClass}">
              <td>${rank}</td>
              <td>${row.Nama}</td>
              <td>${row.Tim || '-'}</td>
              <td>${row.Level || '-'}</td>
              <td>${row.Skor}</td>
            </tr>`;
        });

        tbody.innerHTML = html;
        document.getElementById("lastUpdate").textContent =
          "Terakhir diperbarui: " + new Date().toLocaleTimeString();
      } catch (err) {
        console.error(err);
        document.getElementById("lastUpdate").textContent = "Gagal memuat data üòû";
      }
    }

    updateLeaderboard();
    setInterval(updateLeaderboard, 20000); // üîÅ update tiap 20 detik
  </script>
</body>
</html>
